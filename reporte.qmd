---
title: "Informe Estadístico"
format: html
execute:
  echo: false
params:
  data_path: null
  var_cual_param: null  
  var_cuan1_param: null 
  var_cuan2_param: null 
  color_param: "blue"   
---

```{r}
#| include: false
library(tidyverse)
library(readxl)
library(kableExtra)
library(formattable)
datos <- readRDS(params$data_path)
```

## Informe sobre créditos aperturados en una entidad financiera

El presente informe resume el análisis estadístico de las solicitudes de crédito registradas en la Cooperativa de Ahorro y Crédito “Paquito”. El estudio se centra en cuatro variables principales: **edad** del solicitante, **tipo de crédito**, **provincia de domicilio** y **profesión**, con el propósito de identificar tendencias relevantes en la colocación de créditos y las características predominantes de los usuarios.

El conjunto de datos analizado contiene un total de `r nrow(datos)` registros, correspondientes a operaciones realizadas entre `r min(datos$FECHAADJUDICACION)` y `r max(datos$FECHAADJUDICACION)`.

### Distribución geográfica de los créditos

```{r}
#| include: false
res01 <- datos %>% group_by(PROVINCIA_DOMICILIO) %>% summarise(Creditos = n(), Monto = mean(MONTO_OTORGADO)) %>% mutate(Porcentaje = round(100*Creditos/sum(Creditos),2)) %>% arrange(desc(Creditos))
```

A nivel provincial, se observa una concentración significativa de créditos en las provincias de `r res01$PROVINCIA_DOMICILIO[1]`, `r res01$PROVINCIA_DOMICILIO[2]` y `r res01$PROVINCIA_DOMICILIO[3]`, que en conjunto representan alrededor del `r sum(res01$Porcentaje[1:3])` % del total de operaciones.

Esta concentración puede relacionarse con la ubicación de las agencias principales de la cooperativa y con el nivel de actividad económica de estas provincias. Las provincias con menor número de operaciones registran una participación más baja, lo que sugiere oportunidades de expansión crediticia.

El siguiente cuadro presenta los montos promedio de crédito otorgado por provincia:

```{r}
#| include: false
tb01 %>%
  kable(caption = "Monto promedio de crédito por provincia") %>%
  kable_paper(full_width = F, font_size = 16) %>%
  row_spec(0, bold = T, color = "white", background = "#132b60") %>%
  row_spec(1:3, bold = T, color = "white", background = "#224EC7")
```

### Análisis etario y comportamiento crediticio

El gráfico de dispersión muestra la relación entre la edad del solicitante y el monto otorgado. La mayor parte de los solicitantes se ubica entre los 25 y 55 años, rango que corresponde a la población económicamente activa.

```{r}
#| echo: false
# Simulación del gráfico de dispersión (Grafico02) dentro del informe

library(ggplot2)
library(dplyr)
library(lubridate)

# Verificar que existan las columnas requeridas
if (all(c("FECHANACIMIENTO", "MONTO_OTORGADO") %in% names(datos))) {
  
  # Calcular edad en años
  t02 <- datos %>%
    mutate(EDAD = as.numeric(difftime(Sys.Date(), FECHANACIMIENTO, units = "days")) / 365.25) %>%
    filter(!is.na(EDAD), !is.na(MONTO_OTORGADO))
  
  # Crear gráfico
  ggplot(t02, aes(x = EDAD, y = MONTO_OTORGADO)) +
    geom_point(color = "#132b60", alpha = 0.6, size = 3) +
    labs(title = "Relación entre Edad del Solicitante y Monto Otorgado",
         x = "Edad (años)",
         y = "Monto otorgado") +
    theme_minimal(base_size = 13) +
    theme(plot.title = element_text(hjust = 0.5, color = "#132b60", face = "bold"))
  
} else {
  plot.new()
  text(0.5, 0.5, "No se encontraron las columnas FECHANACIMIENTO y MONTO_OTORGADO en los datos.")
}
```

Se observa que los montos otorgados no presentan una relación lineal con la edad: tanto personas jóvenes como adultas acceden a montos similares. Esto sugiere que el monto del crédito depende más de factores como la capacidad de pago, el tipo de crédito solicitado o el historial financiero que de la edad del solicitante.

Este resultado es positivo, ya que evidencia equidad en la política crediticia de la cooperativa, al no restringir el acceso a grupos etarios específicos.
